{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/managing-focus-with-react-and-jest","result":{"data":{"markdownRemark":{"frontmatter":{"title":"A Deep Dive on Managing Focus with React, Jest, and Enzyme","date":"August 23rd, 2020"},"html":"<h2>What You Will Learn</h2>\n<p>By the end of this article, you will be able to:</p>\n<ul>\n<li>Explain what focus management is and why it's important.</li>\n<li>Use React <code class=\"language-text\">ref</code> to programmatically move focus between elements on a web page.</li>\n<li>Write tests using Jest and Enzyme to check focus management behavior.</li>\n</ul>\n<h2>Prerequisites</h2>\n<p>In order to get the most out of this article, you should already know the basics of how React works. The words \"component,\" \"state,\" and \"props\" should all sound familiar.</p>\n<p>If they don't, here are some resources to help you get up to speed:</p>\n<ul>\n<li>Check out Ali Spittel's post, <a href=\"https://dev.to/aspittel/a-complete-beginners-guide-to-react-2cl6\">A Complete Beginner's Guide to React</a>.</li>\n<li>New to the <code class=\"language-text\">useState</code> hook? Check out Christina Gorton's post, <a href=\"https://dev.to/coffeecraftcode/react-hooks-usestate-3hfo\">React Hooks: useState</a>.</li>\n</ul>\n<h2>The Problem</h2>\n<p>Not everyone who uses a computer can use a mouse. Some users have physical disabilities and need to use keyboard navigation instead. Other users are blind or have low vision and use screen readers to consume and interact with websites. As web developers, it's our responsibility to make sure our products are accessible to all users. That means we need to make sure that our sites are <a href=\"https://www.w3.org/WAI/perspective-videos/keyboard/\">keyboard compatible</a>. That is, a user's keyboard focus should move around the page in a way that makes sense.</p>\n<p>Let's look at an example to see what I mean. The CodePen below has some starter code for the React project we'll be working on in this post. The main content is a table that shows what color you get when you mix two other colors.</p>\n<blockquote>\n<p>This table structure is a simplified version of a project I built recently, a <a href=\"https://meganesu.github.io/generate-gb-opcodes\">table of all the Game Boy opcodes</a>. For more background on that project, check out this article I wrote: <a href=\"/blog/game-boy-opcodes\">Meet the Game Boy Instruction Set</a>.</p>\n</blockquote>\n<p>Each cell in the table has a button. Clicking a button does two things:</p>\n<ol>\n<li>It opens a sidebar.</li>\n<li>It updates the text in the sidebar based on which button was clicked.</li>\n</ol>\n<p>Try using your keyboard to click some of the buttons inside the table, and see what happens to your focus. You can use the Tab key to move your focus between elements, and you can press the Space or Enter keys to click the currently focused element. (Note: you might need to click on the table first to get your focus inside the actual CodePen result window.)</p>\n<iframe style=\"width: 100%; border: none; min-height: 400px;\" title=\"Managing Focus in React (no focus management)\" src=\"https://codepen.io/meganesu/embed/preview/OJVXwer?height=265&theme-id=dark&default-tab=result\" loading=\"lazy\" allowfullscreen=\"true\" >\n  See the Pen <a href='https://codepen.io/meganesu/pen/OJVXwer'>Managing Focus in React (no focus management)</a> by Megan Sullivan\n  (<a href='https://codepen.io/meganesu'>@meganesu</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n<p>See how many times you have to press Tab after clicking a button before your focus moves into the sidebar? The current experience might be feasible for a sighted user who is using a mouse to navigate the page. But keyboard or screen reader users will have to move through a frustrating number of elements before they can actually get to the updated sidebar content. This isn't ideal, especially as the number of table cells grows.</p>\n<p>In this post, you'll learn about how to programmatically manage a user's focus to create a more accessible experience. If you prefer learning by doing, you can fork the CodePen and follow along as we go.</p>\n<h2>The Requirements</h2>\n<p>Here's a more accessible user experience: When a user clicks on one of the buttons in the table, their focus should automatically move into the sidebar. Additionally, when a user clicks on the \"Close sidebar\" button, their focus should automatically go back to the table cell they clicked on in the first place.</p>\n<p>The <a href=\"https://existek.com/blog/what-are-acceptance-criteria/\">acceptance criteria</a> for these two requirements might look something like this:</p>\n<ol>\n<li><strong>Given</strong> the sidebar is closed<br>\n<strong>When</strong> I click on a button in a table cell<br>\n<strong>Then</strong> the keyboard focus moves to the header inside the sidebar.</li>\n<li><strong>Given</strong> the sidebar is open<br>\n<strong>When</strong> I click on the \"Close sidebar\" button<br>\n<strong>Then</strong> the keyboard focus moves back to the table cell button.</li>\n</ol>\n<h2>A Closer Look at the Starter Code</h2>\n<blockquote>\n<p>\"Cut to the chase, Megan. Where's the code?\"</p>\n<p>If you want to jump right into implementing focus management, you can skip ahead to the next section: <a href=\"#react-ref\">How to Move Focus in React: <code class=\"language-text\">ref</code></a></p>\n</blockquote>\n<p>Before we start implementing focus management features, let's get familiar with the component structure of the <a href=\"https://codepen.io/meganesu/pen/OJVXwer\">starter code</a>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAAB0ElEQVQ4y31Ua4/bIBD0//9xrdQvuapWnJ6d+IU588ZgMgVyae1L0pVWSLAM3plZF3gS1+s1r1JKKK1hjMV73aAfBjjnoI3JZ/fae32K4n+ASkkEZ9IOaF9DzuOtILgMeK/bAW43t5kB4yU/N/CkRGi/I9AjPD0haAohBEJ4vFN8fWEb1igspMJy+QHTHWCHX3D9AUGRfPass79f6NcAZX1OvXgsPoBLDak0uDKgTOUUekE7cfxsKM5UoZs1aiJhlnXfso5A6bBnFpNYMDKDhmrMysOHT1pipoeEXdHOBmUn8O04oWw52g8Dptxjy4s1WH0k3TgwLuCWZUd8UtlE5enMQSiL4qicc6wVsaNiJ0bizVoMw4iyLDPxxpgdoPhUd11X1PU73t4O4IzdaPN+a5t/3kuXhIgeVCo/8NWb88zimcZEI4+XFozxfCethYzcce3QTCqSrHEaJKpeQLvwwpsqmrzOXdTNGcfqhLbt0PcDRkJQUGFB+C0p1zgPFKcLQUc+IlcKOvK15Xhv5uvDtOwmJYmRQH6fKlTVEeM4ZsAQAl75df8YNqIkhaOi1kbLkCnO7ZjbS6q+mqZnubNNUlRGkEvkJP0MEvlp79nMvoo/+atDju+L420AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"A diagram of the app component tree\"\n        title=\"A diagram of the app component tree\"\n        src=\"/static/3142a698d3d12e9c56ed895a5fdaae51/5a190/app-structure.png\"\n        srcset=\"/static/3142a698d3d12e9c56ed895a5fdaae51/772e8/app-structure.png 200w,\n/static/3142a698d3d12e9c56ed895a5fdaae51/e17e5/app-structure.png 400w,\n/static/3142a698d3d12e9c56ed895a5fdaae51/5a190/app-structure.png 800w,\n/static/3142a698d3d12e9c56ed895a5fdaae51/c1b63/app-structure.png 1200w,\n/static/3142a698d3d12e9c56ed895a5fdaae51/29007/app-structure.png 1600w,\n/static/3142a698d3d12e9c56ed895a5fdaae51/a6e6b/app-structure.png 2917w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>Here's a breakdown of how all the components fit together:</p>\n<ul>\n<li>\n<p><strong>App</strong>: The top-level component, which renders the Table and Sidebar components.</p>\n<ul>\n<li>\n<p>The App component keeps track of two state variables:</p>\n<ul>\n<li><code class=\"language-text\">showSidebar</code>: a boolean value that is <code class=\"language-text\">true</code> when the sidebar should be open and <code class=\"language-text\">false</code> when it should be closed. The inverse of this value is passed to the Sidebar component as the <code class=\"language-text\">isHidden</code> prop.</li>\n<li><code class=\"language-text\">activeCell</code>: an object corresponding to the input and output colors for the TableCell currently displayed in the Sidebar. On page load, it has an initial value of <code class=\"language-text\">null</code>. This object is passed to the Sidebar component as the <code class=\"language-text\">colors</code> prop.</li>\n</ul>\n</li>\n<li>\n<p>The App component also defines two functions, which get passed down to rendered components as props:</p>\n<ul>\n<li><code class=\"language-text\">updateSidebar(colors)</code>: a function that sets App's <code class=\"language-text\">activeCell</code> state variable to the object passed in as <code class=\"language-text\">colors</code>. It also sets App's <code class=\"language-text\">showSidebar</code> state variable to <code class=\"language-text\">true</code>. This function gets passed to the Table component as a prop.</li>\n<li><code class=\"language-text\">hideSidebar()</code>: a function that sets the value of <code class=\"language-text\">showSidebar</code> in the App state to <code class=\"language-text\">false</code>. It gets passed to the Sidebar component as a prop.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Table</strong>: Renders the HTML <code class=\"language-text\">table</code> element and all of the TableCell components.</p>\n<ul>\n<li>The Table component receives the <code class=\"language-text\">updateSidebar</code> function as a prop from App and passes it down to the TableCell components.</li>\n<li>The Table component also sets the <code class=\"language-text\">colors</code> object for each TableCell. (Since this is a contrived example, the configuration is hard-coded for each TableCell.)</li>\n</ul>\n</li>\n<li>\n<p><strong>Sidebar</strong>: Renders additional details about the currently selected TableCell.</p>\n<ul>\n<li>This component renders an <code class=\"language-text\">h1</code> element for the title of the sidebar, a <code class=\"language-text\">button</code> element for closing the sidebar, and a <code class=\"language-text\">p</code> element with the <code class=\"language-text\">colors</code> details for the TableCell that was clicked.</li>\n<li>When the <code class=\"language-text\">isHidden</code> prop from App is <code class=\"language-text\">true</code>, the Sidebar renders with an additional class that hides the Sidebar by moving it offscreen. When <code class=\"language-text\">isHidden</code> is false, the class is removed, and the Sidebar becomes visible.</li>\n</ul>\n</li>\n<li>\n<p><strong>TableCell</strong>: Renders the <code class=\"language-text\">td</code> element for an individual cell.</p>\n<ul>\n<li>Inside the <code class=\"language-text\">td</code> element, there is a <code class=\"language-text\">button</code> element. When this button is clicked, the click event handler calls the <code class=\"language-text\">updateSidebar</code> function from props and passes it the <code class=\"language-text\">colors</code> prop for that cell.</li>\n</ul>\n</li>\n</ul>\n<h3>What Happens When the Sidebar Opens?</h3>\n<p>Here's a breakdown of how the data flows between components when the sidebar opens:</p>\n<ol>\n<li>The user clicks on the button in a TableCell, which triggers the button's click event handler.</li>\n<li>The event handler calls <code class=\"language-text\">updateSidebar</code> with the value of the <code class=\"language-text\">colors</code> prop for that TableCell.</li>\n<li>The <code class=\"language-text\">updateSidebar</code> function - which is defined in the App component - updates the value of <code class=\"language-text\">activeCell</code> in the App state and sets <code class=\"language-text\">showSidebar</code> in the App state to <code class=\"language-text\">true</code>.</li>\n<li>This state change causes a rerender of the App component, and the Sidebar component gets new prop values for <code class=\"language-text\">colors</code> and <code class=\"language-text\">isHidden</code>.</li>\n<li>Since <code class=\"language-text\">isHidden</code> is now <code class=\"language-text\">false</code> (the opposite of <code class=\"language-text\">showSidebar</code>), the Sidebar component renders without the \"hidden\" class, and the Sidebar becomes visible to the user.</li>\n</ol>\n<h3>What Happens When the Sidebar Closes?</h3>\n<p>Here's a breakdown of how the data flows between components when the sidebar closes.</p>\n<ol>\n<li>The user clicks on the \"Close sidebar\" button in the Sidebar, which triggers the button's click event handler.</li>\n<li>The event handler calls the <code class=\"language-text\">hideSidebar</code> function that was passed into the Sidebar as a prop.</li>\n<li>The <code class=\"language-text\">hideSidebar</code> function - which is defined in the App component - sets <code class=\"language-text\">showSidebar</code> in the App state to <code class=\"language-text\">false</code>.</li>\n<li>This state change causes a rerender of the App component, and the Sidebar component gets a new prop value for <code class=\"language-text\">isHidden</code>.</li>\n<li>Since <code class=\"language-text\">isHidden</code> is now <code class=\"language-text\">true</code> (the opposite of <code class=\"language-text\">showSidebar</code>), the Sidebar component renders with the \"hidden\" class, and the Sidebar slides off the page and out of sight.</li>\n</ol>\n<h2 id=\"react-ref\">How to Move Focus in React: <code class=\"language-text\">ref</code></h2>\n<p>Now that we know how our starter code works and what we want it to do, we can start implementing our focus management requirements. But how do you move focus in a React app? Enter <code class=\"language-text\">ref</code>.</p>\n<p>What is a <code class=\"language-text\">ref</code>? It's short for \"reference.\" It's a way to refer directly to an element in the DOM.</p>\n<p>Normally, in React, information only flows through components in one direction: a parent component passes data down to its children as props. But sometimes, you'll need one component (like the TableCell in our example) to be able to talk to another component in a totally different part of the DOM tree (like the Sidebar). <code class=\"language-text\">ref</code> is React's way of letting you do that.</p>\n<blockquote>\n<p><strong>Don't overuse <code class=\"language-text\">ref</code>!</strong></p>\n<p>Just because you can use <code class=\"language-text\">ref</code> to get around the normal React data flow doesn't mean you should use it for everything. The React team identified <a href=\"https://reactjs.org/docs/refs-and-the-dom.html#when-to-use-refs\">specific use cases where <code class=\"language-text\">ref</code> comes in handy</a> (like managing focus for accessibility). If your situation doesn't fall under one of those use cases, think carefully about whether there's another way to achieve your goal without using <code class=\"language-text\">ref</code>.</p>\n</blockquote>\n<p>The process for using <code class=\"language-text\">ref</code> looks like this:</p>\n<ol>\n<li>Create a new <code class=\"language-text\">ref</code> object.</li>\n<li>Assign that <code class=\"language-text\">ref</code> object to an element in the <code class=\"language-text\">render</code> function of a component.</li>\n</ol>\n<p>Let's take a closer look at each of those steps.</p>\n<h3>Step 1: Create a new <code class=\"language-text\">ref</code> object</h3>\n<p>If you're using functional components, you can create a new <code class=\"language-text\">ref</code> object using the <code class=\"language-text\">useRef</code> hook:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span>initialValue<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Usually, you'll just pass in an initial value of <code class=\"language-text\">null</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> myRef <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></code></pre></div>\n<blockquote>\n<p>If you're using class components, the syntax looks a little different. You can refer to the <a href=\"https://reactjs.org/docs/refs-and-the-dom.html\">official React docs about <code class=\"language-text\">ref</code></a> for the details.</p>\n</blockquote>\n<p>Now you have a variable for the <code class=\"language-text\">ref</code> you created, which you can pass down to child components via props. (We'll take a closer look at how to do that when we start implementing focus management in the next section.)</p>\n<p>But what's actually in that <code class=\"language-text\">ref</code> object? If you log the <code class=\"language-text\">myRef</code> variable to the console, you'll see that it contains an object with a single property called <code class=\"language-text\">current</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Object <span class=\"token punctuation\">{</span> current<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">current</code> property is what keeps track of the node this <code class=\"language-text\">ref</code> is assigned to. To start, it'll be set to whatever you passed in as <code class=\"language-text\">initialValue</code>. The value of the <code class=\"language-text\">current</code> property will change when you assign the <code class=\"language-text\">ref</code> to an element. Which leads us to...</p>\n<h3>Step 2: Assign the <code class=\"language-text\">ref</code> to an element</h3>\n<p>First, decide which DOM element you want to connect to your <code class=\"language-text\">ref</code>. In our case, this is going to be the element we want focused.</p>\n<p>Then, find the place where that element is rendered. Add a <code class=\"language-text\">ref</code> attribute to the element, and set it to the variable you created in step 1.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>button ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>myRef<span class=\"token punctuation\">}</span><span class=\"token operator\">></span> <span class=\"token comment\">// add the ref attribute</span>\n    Click me<span class=\"token operator\">!</span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Once that component mounts, React will update <code class=\"language-text\">myRef.current</code> to be the DOM element you assigned <code class=\"language-text\">myRef</code> to:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Object <span class=\"token punctuation\">{</span> current<span class=\"token operator\">:</span> button <span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>Now that <code class=\"language-text\">myRef.current</code> is a focusable <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement\">HTMLElement</a>, you can call its <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLOrForeignElement/focus\"><code class=\"language-text\">focus</code> method</a>, which will automatically move keyboard focus to that element.</p>\n</blockquote>\n<h2>The Solution</h2>\n<p>Now that we've got a basic understanding of how <code class=\"language-text\">ref</code> works, let's see how to use it within the context of our original problem: programmatically moving the user's focus.</p>\n<h3>Part 1: Move Focus When the Sidebar Opens</h3>\n<p>Let's start with a quick recap of the first acceptance criterion:</p>\n<p><strong>Given</strong> the sidebar is closed <br>\n<strong>When</strong> I click on a button in a table cell <br>\n<strong>Then</strong> the keyboard focus moves to the header inside the sidebar.</p>\n<p>Before we get too deep into the code, let's take a step back and think about the high-level overview of what we need to do:</p>\n<ul>\n<li>Create a new <code class=\"language-text\">ref</code> for the sidebar. Let's call it <code class=\"language-text\">sidebarRef</code>. (So creative!)</li>\n<li>Attach it to the <code class=\"language-text\">h1</code> element in the Sidebar component.</li>\n<li>Call <code class=\"language-text\">sidebarRef.current.focus()</code> when the TableCell button is clicked.</li>\n</ul>\n<p>With that big picture in mind, let's get into the code to implement this:</p>\n<ol>\n<li>\n<p>Start by adding <code class=\"language-text\">useRef</code> to the list of methods imported from React.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Fragment<span class=\"token punctuation\">,</span> useState<span class=\"token punctuation\">,</span> useRef <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>In CodePen, this import looks a little different:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Fragment<span class=\"token punctuation\">,</span> useState<span class=\"token punctuation\">,</span> useRef <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">;</span></code></pre></div>\n</blockquote>\n</li>\n<li>\n<p>Create <code class=\"language-text\">sidebarRef</code>. Which component should we create it in? We know that we eventually want to attach it to the <code class=\"language-text\">h1</code> in the Sidebar component. We also need to be able to call <code class=\"language-text\">sidebarRef.current.focus()</code> when the TableCell is clicked. Since the App component is a parent of Sidebar, and it's where <code class=\"language-text\">updateSidebar</code> (the function called from the TableCell click handler) is defined, let's create <code class=\"language-text\">sidebarRef</code> inside the App component.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>showSidebar<span class=\"token punctuation\">,</span> setShowSidebar<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>activeCell<span class=\"token punctuation\">,</span> setActiveCell<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> sidebarRef <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// add this</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>Now we can pass <code class=\"language-text\">sidebarRef</code> down to the Sidebar component as a prop.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token operator\">&lt;</span>Sidebar\n      colors<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>activeCell<span class=\"token punctuation\">}</span>\n      hideSidebar<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>hideSidebar<span class=\"token punctuation\">}</span>\n      isHidden<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>showSidebar<span class=\"token punctuation\">}</span>\n      sidebarRef<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>sidebarRef<span class=\"token punctuation\">}</span> <span class=\"token comment\">// add this</span>\n    <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>In Sidebar, add a <code class=\"language-text\">ref</code> attribute to the element we want to focus on when the sidebar opens (i.e., the <code class=\"language-text\">h1</code> header). Set the value to the new <code class=\"language-text\">sidebarRef</code> prop. Since headers aren't focusable elements by default, we'll also need to add the <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/tabindex\"><code class=\"language-text\">tabIndex</code> attribute</a> to make the <code class=\"language-text\">h1</code> focusable. Give it a value of <code class=\"language-text\">-1</code>. (That way, users won't be able to focus on the header when they're tabbing sequentially through the page, but we'll still be able to programmatically move focus to it.)</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> Sidebar <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  colors<span class=\"token punctuation\">,</span>\n  hideSidebar<span class=\"token punctuation\">,</span>\n  isHidden<span class=\"token punctuation\">,</span>\n  sidebarRef <span class=\"token comment\">// add this</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">return</span><span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token operator\">&lt;</span>h1\n      ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>sidebarRef<span class=\"token punctuation\">}</span> <span class=\"token comment\">// add this</span>\n      tabIndex<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">// add this</span>\n    <span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>colors<span class=\"token punctuation\">.</span>output<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>Finally, go back to the <code class=\"language-text\">updateSidebar</code> function in the App component. Add a step to move focus to the element assigned to <code class=\"language-text\">sidebarRef</code>.</p>\n<blockquote>\n<p>Since <code class=\"language-text\">sidebarRef</code> is defined inside of App, you can access it inside of <code class=\"language-text\">updateSidebar</code>.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">updateSidebar</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">colors</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setActiveCell</span><span class=\"token punctuation\">(</span>colors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setShowSidebar</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    sidebarRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// add this</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ol>\n<p>Now, the most important part of adding accessibilty features: manual testing! When you view the project in a browser, you should be able to click (or press enter) on a button in the table and see your focus automatically move to the header in the sidebar! Try it out with a keyboard, then <a href=\"https://webaim.org/articles/screenreader_testing/\">test it with a screen reader</a>.</p>\n<p>Here's <a href=\"https://codepen.io/meganesu/pen/jOPMbGX\">another CodePen</a> with all the changes we've made so far:</p>\n<iframe style=\"width: 100%; border: none; min-height: 400px;\" title=\"Managing Focus in React (move focus on sidebar open only)\" src=\"https://codepen.io/meganesu/embed/preview/jOPMbGX?height=265&theme-id=dark&default-tab=result\" loading=\"lazy\" allowfullscreen=\"true\">\n  See the Pen <a href='https://codepen.io/meganesu/pen/jOPMbGX'>Managing Focus in React (move focus on sidebar open only)</a> by Megan Sullivan\n  (<a href='https://codepen.io/meganesu'>@meganesu</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n<blockquote>\n<p><strong>Note:</strong> For this focus management solution to work correctly, you need the sidebar to always be rendered in the DOM.</p>\n<p>When I initially built this project, I used <a href=\"https://reactjs.org/docs/conditional-rendering.html\">conditional rendering</a> to only add the Sidebar component to the DOM if it was visible on the screen. But this caused problems with the focus management behavior.</p>\n<p>The first time I clicked a TableCell button, the sidebar would open, but the keyboard focus wouldn't move. It turns out, this was because the Sidebar component wasn't mounted yet, which meant that <code class=\"language-text\">sidebarRef.current</code> wasn't assigned to anything. To get the focus to move into the sidebar, I had to click the TableCell button twice: once to open the sidebar and mount the component, and once to actually move focus once the component was mounted. Not ideal.</p>\n</blockquote>\n<h3>Part 2: Move Focus When the Sidebar Closes</h3>\n<p>You're halfway done! Hang in there, you're doing great.</p>\n<p>Let's take another look at our second acceptance criterion:</p>\n<p><strong>Given</strong> the sidebar is open<br>\n<strong>When</strong> I click on the \"Close sidebar\" button<br>\n<strong>Then</strong> the keyboard focus moves back to the table cell button.</p>\n<p>Like last time, let's take a step back and lay out a high-level overview of what we need to do:</p>\n<ul>\n<li>Create a new <code class=\"language-text\">ref</code> for the TableCell button. Let's call it <code class=\"language-text\">buttonRef</code>. (Another creative name.)</li>\n<li>Attach it to the <code class=\"language-text\">button</code> element in the TableCell component.</li>\n<li>Update the TableCell button click handler to keep track of the last <code class=\"language-text\">buttonRef</code> clicked. We'll use a new React state variable for this. Let's call it <code class=\"language-text\">lastCellClicked</code>.</li>\n<li>Call <code class=\"language-text\">lastCellClicked.current.focus()</code> when the \"Close sidebar\" button is clicked.</li>\n</ul>\n<p>Now let's implement this in code:</p>\n<ol>\n<li>\n<p>Create <code class=\"language-text\">buttonRef</code>. Which component should we create it in? Since we want to have a separate <code class=\"language-text\">ref</code> object for each TableCell, let's define <code class=\"language-text\">buttonRef</code> in the TableCell component. That way, each TableCell that mounts will have its own unique <code class=\"language-text\">ref</code> that can be focused independently.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">TableCell</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> colors<span class=\"token punctuation\">,</span> updateSidebar <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> buttonRef <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// add this</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>Now attach <code class=\"language-text\">buttonRef</code> to the <code class=\"language-text\">button</code> element in the TableCell component.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">TableCell</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> colors<span class=\"token punctuation\">,</span> updateSidebar <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>td<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>button\n        onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">updateSidebar</span><span class=\"token punctuation\">(</span>colors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n        ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>buttonRef<span class=\"token punctuation\">}</span> <span class=\"token comment\">// add this</span>\n      <span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span> colors<span class=\"token punctuation\">.</span>output <span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>td<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>Pass <code class=\"language-text\">buttonRef</code> as an additional argument to <code class=\"language-text\">updateSidebar</code> when it's called in the TableCell <code class=\"language-text\">button</code> click handler. (We'll get to <code class=\"language-text\">updateSidebar</code> in a moment.)</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">TableCell</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> colors<span class=\"token punctuation\">,</span> updateSidebar <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// ...</span>\n    <span class=\"token operator\">&lt;</span>button\n      onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">updateSidebar</span><span class=\"token punctuation\">(</span>colors<span class=\"token punctuation\">,</span> buttonRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span> <span class=\"token comment\">// add buttonRef</span>\n      ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>buttonRef<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">></span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>Create a new state variable to keep track of the last cell clicked. Where should this state variable be created? We know we'll want to update it when <code class=\"language-text\">updateSidebar</code> is called. Since <code class=\"language-text\">updateSidebar</code> is defined in the App component, let's create the new state variable there as well. We can use an initial value of <code class=\"language-text\">null</code>, since when the App first mounts none of the TableCells have been clicked yet.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>showSidebar<span class=\"token punctuation\">,</span> setShowSidebar<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>activeCell<span class=\"token punctuation\">,</span> setActiveCell<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>lastCellClicked<span class=\"token punctuation\">,</span> setLastCellClicked<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// add this</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>Now it's time to change <code class=\"language-text\">updateSidebar</code>. First, we can add the new <code class=\"language-text\">buttonRef</code> parameter. Then, we can set <code class=\"language-text\">lastCellClicked</code> to the <code class=\"language-text\">buttonRef</code> that's passed in.</p>\n<blockquote>\n<p>To summarize, this means that when a user clicks on a TableCell button and <code class=\"language-text\">updateSidebar</code> is called, <code class=\"language-text\">lastCellClicked</code> will be updated with the <code class=\"language-text\">ref</code> for the TableCell button that was clicked.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">updateSidebar</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">colors<span class=\"token punctuation\">,</span> buttonRef</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// add buttonRef parameter</span>\n    <span class=\"token function\">setLastCellClicked</span><span class=\"token punctuation\">(</span>buttonRef<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// add this</span>\n    <span class=\"token function\">setActiveCell</span><span class=\"token punctuation\">(</span>colors<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setShowSidebar</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    sidebarRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>Now that we have a way to determine the most recently clicked TableCell, we can update <code class=\"language-text\">hideSidebar</code> to move focus back to that TableCell button when the \"Close sidebar\" button is clicked.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">hideSidebar</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setShowSidebar</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    lastCellClicked<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">focus</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// add this</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ol>\n<p>And that should do it! Don't forget to manually test your changes to make sure it's working as expected. Now, when you view the project in a browser, your focus should move into the sidebar when you click a TableCell button, and it should move back to that TableCell button when you close the sidebar. Try it out with a keyboard and with a screen reader. So much nicer than the initial experience!</p>\n<p>Here's <a href=\"https://codepen.io/meganesu/pen/abOmwbg\">the final CodePen</a>, with all our focus management changes:</p>\n<iframe style=\"width: 100%; border: none; min-height: 400px;\" title=\"Managing Focus in React (move focus on sidebar open and close)\" src=\"https://codepen.io/meganesu/embed/preview/abOmwbg?height=265&theme-id=dark&default-tab=result\" loading=\"lazy\" allowfullscreen=\"true\">\n  See the Pen <a href='https://codepen.io/meganesu/pen/abOmwbg'>Managing Focus in React (move focus on sidebar open and close)</a> by Megan Sullivan\n  (<a href='https://codepen.io/meganesu'>@meganesu</a>) on <a href='https://codepen.io'>CodePen</a>.\n</iframe>\n<h2>Writing Tests</h2>\n<p>As with any new functionality, it's a good idea to write tests along the way, so that you can be sure that things work (and continue to work) as you expect them to.</p>\n<p>One tip to keep in mind: you should test the side effects of your application, not the implementation. Instead of checking that a particular function was called, think about what behavior your end user expects and check that.</p>\n<blockquote>\n<p><strong>Do yourself a favor!</strong> </p>\n<p>If your tests are too closely tied to the exact implementation of your app, they become brittle. For example, imagine Future You decides to change the way you implemented a feature, without affecting the end result. You'll probably also end up needing to change your tests, even though your end users see the same behavior.</p>\n<p>On the other hand, if your tests are checking for side effects - things you expect your code to have done by the time it finishes running - they'll be more flexible and less likely to fail due to refactoring.</p>\n</blockquote>\n<p>Let's take one last look at our acceptance criteria:</p>\n<ol>\n<li><strong>Given</strong> the sidebar is closed<br>\n<strong>When</strong> I click on a button in a table cell<br>\n<strong>Then</strong> the keyboard focus moves to the header inside the sidebar.</li>\n<li><strong>Given</strong> the sidebar is open<br>\n<strong>When</strong> I click on the \"Close sidebar\" button<br>\n<strong>Then</strong> the keyboard focus moves back to the table cell button.</li>\n</ol>\n<p>Both of these test scenarios have a similar structure:</p>\n<ul>\n<li>Interact with an element on the page.</li>\n<li>Check that the correct element has focus at the end of the interaction.</li>\n</ul>\n<h3>Using Jest v24.9.0</h3>\n<p>When I first wrote these tests, I was using an older version of Jest, v24.9.0. Here's what the initial tests looked like:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> component <span class=\"token operator\">=</span> <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'when a TableCell is clicked'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> firstTableCellButton<span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">beforeAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> firstTableCell <span class=\"token operator\">=</span> component<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">'TableCell'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">first</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    firstTableCellButton <span class=\"token operator\">=</span> firstTableCell<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    firstTableCellButton<span class=\"token punctuation\">.</span><span class=\"token function\">simulate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'moves focus to the header in the Sidebar'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> sidebarHeader <span class=\"token operator\">=</span> component<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Sidebar h1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>activeElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span>sidebarHeader<span class=\"token punctuation\">.</span><span class=\"token function\">getDOMNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'when close sidebar button is clicked'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">beforeAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      component<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Sidebar button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">simulate</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'moves focus back to the last TableCell clicked'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>activeElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span>firstTableCellButton<span class=\"token punctuation\">.</span><span class=\"token function\">getDOMNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>A few notes that might be helpful:</p>\n<ul>\n<li>\n<p><a href=\"https://enzymejs.github.io/enzyme/docs/api/ReactWrapper/getDOMNode.html\"><code class=\"language-text\">getDOMNode()</code></a> comes from Enzyme. It returns the DOM node for an Enzyme wrapper.</p>\n<ul>\n<li>For example, <code class=\"language-text\">component.find(&#39;Sidebar h1&#39;)</code> returns an Enzyme wrapper for the <code class=\"language-text\">h1</code> element in the Sidebar. Calling <code class=\"language-text\">component.find(&#39;Sidebar h1&#39;).getDOMNode()</code> returns the actual DOM element for the <code class=\"language-text\">h1</code>.</li>\n</ul>\n</li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/DocumentOrShadowRoot/activeElement\"><code class=\"language-text\">document.activeElement</code></a> is a property that returns the DOM element that currently has focus. In our tests, this property comes from <a href=\"https://github.com/jsdom/jsdom\">JSDOM</a>, another library that's a dependency of Jest.</li>\n</ul>\n<h3>Using Jest v25+</h3>\n<p>The update from Jest v24 to v25 includes a big jump in JSDOM versions (v11.5.1 to v15.1.1), which you can see in the <a href=\"https://github.com/facebook/jest/blob/master/CHANGELOG.md#chore--maintenance-5\">Jest changelog</a>. For me, when I upgraded my Jest dependency to the latest version (at the time, v25.2.7), my focus management tests broke.</p>\n<p>From what I was able to trace down, this problem was because JSDOM changed the way they treated <code class=\"language-text\">document.activeElement</code>. (To be completely honest, I couldn't figure out what specifically the change was, and I got tired of digging through codebases. If you have more information on what happened, please reach out and let me know!)</p>\n<p>By combing through linked pull requests (PRs), I found this fix from a <a href=\"https://github.com/carbon-design-system/carbon/pull/5456/files\">PR in the Carbon Design System repo</a>. Here's what my updated tests looked like after following that pull request:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> container <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ncontainer<span class=\"token punctuation\">.</span>id <span class=\"token operator\">=</span> <span class=\"token string\">'container'</span><span class=\"token punctuation\">;</span>\ndocument<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>container<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> component <span class=\"token operator\">=</span> <span class=\"token function\">mount</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  attachTo<span class=\"token operator\">:</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#container'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'when a TableCell is clicked'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To fix the tests, I had to create a fake DOM element and then explicitly mount the App component onto that element. The content of the tests themselves didn't change.</p>\n<h2>Next Steps</h2>\n<p>Congratulations, you made it to the end! 🥳</p>\n<p>In this post, you learned about how to programmatically move a user's focus when opening and closing a sidebar. But there are still more ways to improve the accessibility of this design!</p>\n<p>The next improvement I'm hoping to make is trapping focus inside the sidebar when it's open. That is, when users have the sidebar open and they repeatedly hit the Tab key, their focus should stay inside of the sidebar and not end up back in the rest of the body of the page. I'm planning on using something like the inert polyfill described in this <a href=\"https://www.youtube.com/watch?v=fGLp_gfMMGU\">A11ycasts YouTube Video: Inert Polyfill</a>.</p>\n<p>Until then, <a href=\"https://twitter.com/meganesulli\">reach out to me on Twitter</a> and let me know what you think about this post! I'm by no means an accessibility expert, and I'm always looking for new things to learn. What other opportunities do you see for accessibility improvements, in this project or in general?</p>\n<h2>Resources</h2>\n<p>The diagrams in this post were created using <a href=\"https://excalidraw.com/\">Excalidraw</a>.</p>\n<h3>Accessibility</h3>\n<ul>\n<li><a href=\"https://www.w3.org/WAI/perspective-videos/keyboard/\">W3C WAI overview on keyboard compatibility</a></li>\n</ul>\n<h3>React Documentation</h3>\n<ul>\n<li><a href=\"https://reactjs.org/docs/refs-and-the-dom.html\">React <code class=\"language-text\">ref</code> documentation</a></li>\n<li><a href=\"https://reactjs.org/docs/hooks-reference.html#useref\">React <code class=\"language-text\">useRef</code> hook documentation</a></li>\n<li><a href=\"https://reactjs.org/docs/accessibility.html#focus-control\">React accessibility documentation about focus control</a></li>\n</ul>\n<h3>Troubleshooting Jest Upgrade</h3>\n<ul>\n<li>\n<p><a href=\"https://github.com/facebook/jest/blob/master/CHANGELOG.md#2510\">Jest Changelog for v25.1.0</a></p>\n<ul>\n<li><a href=\"https://github.com/facebook/jest/pull/8851\">Jest PR to update JSDOM</a></li>\n</ul>\n</li>\n<li><a href=\"https://github.com/jsdom/jsdom/blob/master/Changelog.md\">JSDOM Changelog</a></li>\n<li><a href=\"https://github.com/jsdom/jsdom/issues/2723\">JSDOM Issue #2723: <code class=\"language-text\">document.activeElement</code> not working in 15.2.1</a></li>\n<li><a href=\"https://github.com/jsdom/jsdom/issues/2586\">JSDOM Issue #2586: <code class=\"language-text\">Element.focus()</code> does not set active element on document object</a></li>\n<li><a href=\"https://github.com/carbon-design-system/carbon/pull/5456/files\">Carbon Design System PR with test changes to work around JSDOM problem</a></li>\n</ul>\n<h3>Future Improvements</h3>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=fGLp_gfMMGU\">A11ycasts #02: Inert Polyfill</a></li>\n</ul>"}},"pageContext":{"slug":"managing-focus-with-react-and-jest"}},"staticQueryHashes":[]}